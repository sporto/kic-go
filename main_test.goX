package main

import (
	"github.com/stretchr/codecs/services"
	"github.com/stretchr/goweb"
	"github.com/stretchr/goweb/handlers"
	"github.com/stretchr/testify/assert"
	testifyhttp "github.com/stretchr/testify/http"
	"net/http"
	"testing"
	"github.com/sporto/kic/api"
)

func init() {
	initDb()
}

func TestRoutes(t *testing.T) {

	// make a test HttpHandler and use it
	codecService := new(services.WebCodecService)
	handler := handlers.NewHttpHandler(codecService)
	goweb.SetDefaultHttpHandler(handler)

	// call the target code
	api.mapRoutes()

	goweb.Test(t, "GET api/accounts/", func(t *testing.T, response *testifyhttp.TestResponseWriter) {
		// should be 200
		assert.Equal(t, http.StatusOK, response.WrittenHeaderInt, "Status code should be correct")
	})

}